<%@ page contentType="text/html;charset=UTF-8" %>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>

<c:set var="ctx" value="${pageContext.request.contextPath}"/>

<html>
<head>
<script src="${ctx }/static/My97/WdatePicker.js"></script>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>评价列表</title>
</head>
<body>
	<form action="list" method="post" id="queryForm">
		<table>
			<tr>
				<td><label class="control-label">上级评价ID</label></td>
				<td><input type="text" id="id" name="search_EQ_id" value="${searchParams.EQ_id }"></td>
				<td><label class="control-label">评价时间</label></td>
				<td><input class="Wdate" id="firstTime" type="text" onfocus="new WdatePicker({lang:'zh-cn',dateFmt:'yyyy-MM-dd'})" name="search_GTE_evaluatedTime" value="${searchParams.GTE_evaluatedTime }"/>
							~
							<input class="Wdate" id="lastTime" type="text" onfocus="new WdatePicker({lang:'zh-cn',dateFmt:'yyyy-MM-dd'})" name="search_LTE_evaluatedTime" value="${searchParams.LTE_evaluatedTime }"/>
				</td>
			</tr>
			<tr>
				<td><label class="control-label">评价者</label></td>
				<td><input type="text" id="mt" name="search_EQ_mt" value="${searchParams.EQ_mt }"></td>
				<td><label class="control-label">总分</label></td>
				<td><input type="text" id="score" name="search_score" value="${score }"></td>
			</tr>
			<tr>
				<td><label class="control-label">被评价者</label></td>
				<td><input type="text" name="search_EQ_beEvaluatedName" value="${searchParams.EQ_beEvaluatedName }"></td>
				<td><label class="control-label">部门</label></td>
				<td>
					<select id="mtSelector" name="search_EQ_departmentName">
						<option value="">全部</option>
						<option value="产品MT">产品MT</option>
						<option value="开发MT">开发MT</option>
						<option value="测试MT">测试MT</option>
					</select>
				</td>
			</tr>
		</table>
		<button>搜索</button>
					<button type="button" onclick="resetSearch();">清空</button>
	</form>
	</br>
	<table class="table table-striped table-bordered table-condensed">
		<thead>
			<tr>
				<td>序号</td>
				<td>上级评价ID</td>
				<td>被评价者</td>
				<td>部门</td>
				<td>评价者</td>
				<td>评价时间</td>
				<td>总分</td>
				<td>评语</td>
				<td>操作</td>
			</tr>
		</thead>
		<tbody id="tbody">
		</tbody>
	<div id="pager"></div>
	<script type="text/x-jquery-tmpl" id="tmplList">
		{{each(i,p) data.content}}
				<tr>
					<td>@{i+1}</td>
					<td>@{p.id}</td>
					<td>@{p.beEvaluatedName}</td>
					<td>@{p.departmentName}</td>
					<td>@{p.mt}</td>
					<td>@{p.evaluatedTime}</td>
					<td>@{p.action1_Score + p.action2_Score + p.action3_Score + p.action4_Score + p.action5_Score }</td>
					<td>@{p.comment}</td>
					<td><a href="viewPage/@{p.id}">查看</a></td>
				</tr>
		{{/each}}
	</script>
	</table>
	
	<script type="text/javascript">
		var pageSize = 10;
		$(function() {
			validate();
			$("#queryForm").submit();
		})
		
		//转化时间格式
		function formatDate(times) {
			var date = new Date(times);
			var fm = date.format('yyyy-MM-dd');
			return fm;
		}
		
		//分页方法
		function getData(pageIndex) {
			var queryData = $("#queryForm").serialize();
			pageIndex = pageIndex - 1;
			queryData = queryData + "&pageIndex=" + pageIndex + "&pageSize=" + pageSize;
			var sort = "totalScore";
			$.ajax({
				type : "POST",
				url : "${ctx}/admin/leaderAssessment/list",
				data : queryData,
				success : function(data) {
					if (data == null) {
						$("#tbody").html("暂无记录");
					} else {
						$("#tbody").html($("#tmplList").tpl({
							data : data
						}));
					}
					
					//分页控件
					var pager = new pagination(function() {
						getData($(this).attr("data-index"));
					});
					pager.pageIndex = data.number + 1;	//当前页码
					pager.pageSize = data.size;	//页大小
					pager.totalCount = data.totalElements;  //总条数
					pager.totalPage = data.totalPages;	//总页数
					$("#pager").html(pager.creat());
				}
			});
		};
	</script>
	<script>
	function validate() {
		$("#queryForm").validate({
			rules:{
				id:{digits:true},
				score:{number:true},
				firstTime:{date:true},
				lastTime:{date:true}
			},
			messages:{
			/* 	leaderAssessmentScore:{
					number:"必须是数字"
				} ,
				efficiencyScore:{
					number:"必须是数字"
				} ,
				specialtyScore:{
					number:"必须是数字"
				} ,
				satisfactionScore:{
					number:"必须是数字"
				} ,
				totalScore:{
					number:"必须是数字"
				}  */
			},
			submitHandler:function(form){
				getData(1);
			}
		});
	}
	
	//清空表单
	function resetSearch() {
		$("input").val('');
		$("#mtSelector").val("");
	}
	</script>
</body>

</html>