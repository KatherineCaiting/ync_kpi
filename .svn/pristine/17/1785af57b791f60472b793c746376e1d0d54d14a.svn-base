<%@ page contentType="text/html;charset=UTF-8"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"%>
<%@ taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt"%>
<c:set var="ctx" value="${pageContext.request.contextPath}" />

<html>
<head>
<title>用户管理</title>
</head>
<body>
	<form id="queryForm" class="row">
		<div class="span4">
			<label for="id" class="control-label">绩效总评ID:</label>
			<div class="controls">
				<input type="text" id="id" name="id" class="input-medium" />
			</div>
		</div>
		<div class="span4">
			<label for="efficiencyScore" class="control-label">效能得分:</label>
			<div class="controls">
				<input type="text" id="efficiencyScore" name="efficiencyScore"
					class="input-medium"/>
			</div>
		</div>
		<div class="span4">
			<label for="totalScore" class="control-label">总分:</label>
			<div class="controls">
				<input type="text" id="totalScore" name="totalScore"
					class="input-medium"/>
			</div>
		</div>
		<div class="span4">
			<label for="beEvaluatedName" class="control-label">被评价者:</label>
			<div class="controls">
				<input type="text" id="beEvaluatedName" name="beEvaluatedName"
					class="input-medium" />
			</div>
		</div>
		<div class="span4">
			<label for="specialtyScore" class="control-label">专业得分:</label>
			<div class="controls">
				<input type="text" id="specialtyScore" name="specialtyScore"
					class="input-medium"/>
			</div>
		</div>
		<div class="span4">
			<label for="totalGrade" class="control-label">总评级别:</label>
			<div class="controls">
				<select id="totalGrade" name="totalGrade">
					<option selected="selected"></option>
					<option value="S">S</option>
					<option value="A">A</option>
					<option value="B">B</option>
					<option value="C">C</option>
					<option value="D">D</option>
				</select>
			</div>
		</div>
		<div class="span4">
			<label for="departmentName" class="control-label">部门:</label>
			<div class="controls">
				<input type="text" id="departmentName" name="departmentName"
					class="input-medium" />
			</div>
		</div>
		<div class="span8">
			<label for="leaderAssessmentScore" class="control-label">上级评价得分:</label>
			<div class="controls">
				<input type="text" id="leaderAssessmentScore"
					name="leaderAssessmentScore" class="input-medium" />
			</div>
		</div>
		<div class="span4">
			<label for="createTime" class="control-label">时间:</label>
			<div class="controls">
				<input onfocus="new WdatePicker({lang:'zh-cn',dateFmt:'yyyy-MM'})" type="text" id="createTime" name="createTime"
					class="input-medium"/>
			</div>
		</div>
		<div class="span4">
			<label for="satisfactionScore" class="control-label">客户满意得分:</label>
			<div class="controls">
				<input type="text" id="satisfactionScore" name="satisfactionScore"
					class="input-medium" />
			</div>
		</div>

		<div class="span4">
			<button id="btnSearch" type="button" class="btn btn-large">搜索</button>
		</div>
		<input type="hidden" name="sort" value="totalScore" />
	</form>
	<div id="pager"></div>
	<table id="contentTable"
		class="table table-striped table-bordered table-condensed">
		<thead>
			<tr>
				<th>序号</th>
				<th>绩效总评ID</th>
				<th>被评价者</th>
				<th>部门</th>
				<th>效能</th>
				<th>专业</th>
				<th>上级评价</th>
				<th>客户满意</th>
				<th>总分</th>
				<th>总评分级</th>
				<th>时间</th>
				<th>操作</th>
			</tr>
		</thead>
		<tbody id="tbody">
		</tbody>
	</table>

	<script type="text/x-jquery-tmpl" id="tmplList">
		{{each(i,p) data.content}}
				<tr>
					<td>@{i+1}</td>
					<td>@{p.id}</td>
					<td>@{p.beEvaluatedName}</td>
					<td>@{p.departmentName}</td>
					<td>@{p.efficiencyScore}</td>
					<td>@{p.specialtyScore}</td>
					<td>@{p.leaderAssessmentScore}</td>
					<td>@{p.satisfactionScore}</td>
					<td>@{p.totalScore}</td>
					<td>@{p.totalGrade}</td>
					<td>@{formatDate(p.createTime)}</td>
					<td><a href="${ctx}/admin/performanceEvaluation/detail/@{p.id}">查看</a></td>
				</tr>
		{{/each}}
	</script>
	<script type="text/javascript">
	var pageSize=3;
		$(function() {
			getData(1);
			$("#btnSearch").click(function(){
				getData(1);
			})
		})
		function formatDate(times) {
			var date = new Date(times);
			var fm = date.format('yyyy-MM-dd');
			return fm;
		}
		function getData(pageIndex) {
			var queryData=$("#queryForm").serialize();
			pageIndex=pageIndex-1;
			queryData=queryData+"&pageIndex="+pageIndex+"&pageSize="+pageSize;
			var sort="totalScore";
			$.ajax({
				type : "POST",
				url : "${ctx}/admin/performanceEvaluation",
				data:queryData,
				success : function(data) {
					if (data == null || data.records == 0) {
						$("#tbody").html("暂无记录");
					} else {
						$("#tbody").html($("#tmplList").tpl({
							data : data
						}));
					}
					//分页控件
					var pager = new pagination(function() {
						getData($(this).attr("data-index"));
					});
					pager.pageIndex = data.number+1;//当前页码
					pager.pageSize = data.size;//页大小
					pager.totalCount = data.totalElements;//总条数
					pager.totalPage = data.totalPages;//总页数
					$("#pager").html(pager.creat());
				}
			});
		};
	</script>
	<script src="${ctx}/static/My97/WdatePicker.js"></script>
</body>
</html>
