/*******************************************************************************
 * Copyright (c) 2005, 2014 springside.github.io
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 *******************************************************************************/
package com.ync365.oa.service.task;

import java.text.SimpleDateFormat;
import java.util.Calendar;
import java.util.List;

import javax.transaction.Transactional;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.beans.factory.annotation.Autowired;

import com.ync365.oa.entity.Department;
import com.ync365.oa.service.department.DepartmentService;
import com.ync365.oa.service.pecontroller.PeControllerService;
import com.ync365.oa.service.properties.PropertiesService;
@Transactional
public class TaskService {
    private Logger log = LoggerFactory.getLogger(TaskService.class);
    @Autowired
    private PropertiesService s;
    @Autowired
    private PeControllerService peControllerService;
    @Autowired
    private DepartmentService departmentService;

    SimpleDateFormat f=new SimpleDateFormat("yyyy-MM");
    /**
     * 每月1日0点执行
     * @Title: doNotifyMT
     * @Description: 
     * @author: duan.zhao.qian
     * @date: 2015年12月8日 上午9:08:18
     * @version: 
     *
     *
     */
    public void doNotifyMT() {
        log.info("doNotifyMT >> 每月1号0点执行");
        List<Department> list=departmentService.getAll();
        Calendar calendar=Calendar.getInstance();
        calendar.add(Calendar.MONTH, -1);
        for (Department department : list) {
            peControllerService.checkIsProcessed(department.getId(), department.getName(), f.format(calendar.getTime()));
        }
        //生成月度客户评价
        //生成月度上级评价
        //生成月度员工效能
        //        System.out.println("doNotifyMT >>> " + Calendar.getInstance().getTime().toLocaleString());
        //        System.out.println(PropertiesService.EFFICIENCY_SCORE);
        //        System.out.println(PropertiesService.LEADER_ASSESSMENT_SCORE);
        //        System.out.println(PropertiesService.SATISFACTION_SCORE);
        //        System.out.println(PropertiesService.SPECIALTY_SCORE);
    }

    /**
     * 每月4号0点执行
     * @Title: doCalculateScore
     * @Description: 
     * @author: duan.zhao.qian
     * @date: 2015年12月8日 上午9:08:42
     * @version: 
     *
     *
     */
    public void doCalculateScore() {
        log.info("doCalculateScore >> 每月4号0点执行");
        //计算员工绩效
        //        System.out.println("doCalculateScore >>> " + Calendar.getInstance().getTime().toLocaleString());
    }

    /**
     * 每分钟更新配置
     * @Title: doSetProperties
     * @Description: 
     * @author: duan.zhao.qian
     * @date: 2015年12月8日 上午9:10:21
     * @version: 
     *
     *
     */
    public void doSetProperties() {
        s.setProperties();
    }
}
