<%@ page contentType="text/html;charset=UTF-8" %>
<%@ page import="org.apache.shiro.web.filter.authc.FormAuthenticationFilter"%>
<%@ page import="org.apache.shiro.authc.ExcessiveAttemptsException"%>
<%@ page import="org.apache.shiro.authc.IncorrectCredentialsException"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<c:set var="ctx" value="${pageContext.request.contextPath}"/>

<html>
<head>
	<title>效能-项目页面</title>
	<script type="text/javascript" src="${ctx}/static/jquery/jquery-1.9.1.min.js"></script>
	
	<script type="text/javascript">
		function js_method(eff_id,t_id,s){
			var effId = eff_id;//主键id
			var tId = t_id;//当前a标签id
			var ss =s;
			
			var first=$("#"+tId);//获取当前id的对象
			var second=first.parent().prev().prev()[0].id;//获取录入工时的id
			var input_id = first.prev()[0].id//获取录入工时input的id
			
			var input_val = $("#"+input_id).val();
			if(null != input_val){
				$.ajax({ 
			        type: "GET", 
			       	url: "${ctx}/efficiency/listAjax?hours="+input_val+"&id="+effId+"&i=ss", 
			        dataType:"json", 
			        success: function(data){ 
			        		$("#"+second).html("");
			        	 	var tml = "周期："+data.actualBeginTime+"至"+${data.actualEndTime}+"；工时："+data.actualHours+"小时";
			        	 	$("#"+second).html(tml);
			        } ,
				});
			}
			
		}
	</script>
</head>

<body>
	<a href="${ctx}/efficiency/addPage">新建项目</a>	
	<a href="${ctx}/efficiency/editPage?proId=${project.id}">修改项目</a>
	<form id="loginForm" action="${ctx}/login" method="post" class="form-horizontal">
	</form>
	
	计划时间：<br/>
	<table align="center" border="1px;" style="border-collapse: collapse;width: 800px;" bordercolor="#000000">
	   <tr>
	   		<td>姓名</td>
	   		<td>部门</td>
	   		<td>计划时长</td>
	   </tr>
	   
	   <c:forEach items="${list}" var="listTemp" varStatus="s" >
			<tr>
		   		<td>${listTemp.employeName}</td>
		   		<td>${listTemp.departmentName}</td>
		   		<td>周期：${listTemp.planBeginTime}至${listTemp.planEndTime}；工时：${listTemp.planHours}小时</td>
	   		</tr>
	   </c:forEach>
	
	</table>
	
	实际时间：<br/>
	<table align="center" border="1px;" style="border-collapse: collapse;width: 800px;" bordercolor="#000000">
	   <tr>
	   		<td>姓名</td>
	   		<td>部门</td>
	   		<td>实际工时</td>
	   		<td>产出工时</td>
	   		<td>录入实际工时</td>
	   		<td>录入产出工时</td>
	   </tr>
	   
	   <c:forEach items="${list}" var="listTemp" varStatus="s" >
			<tr>
		   		<td>
		   			${listTemp.employeName}
		   			<%-- <input type ="text" id="" name="id" value="${listTemp.id }" /> --%>
		   		</td>
		   		<td>${listTemp.departmentName}</td>
		   		<td id= "td_t_${s.index}">周期：${listTemp.actualBeginTime}至${listTemp.actualEndTime}；工时：${listTemp.actualHours}</td>
		   		<td id = "td_td_t_${s.index}">周期：${listTemp.outputBeginTime}至${listTemp.outputEndTime}；工时：${listTemp.outputHours}</td>
		   		<td>
		   			<input type ="text" name="" id="id_i_${s.index}"  />
		   			<a  href="javascript:void(0);" id = "t_${s.index}" onclick="js_method(${listTemp.id },this.id,1)">录入</a>
		   		</td>
		   		<td>
			   		<input type ="text" id="input_id_${s.index}" name=""  />
			   		<a href="javascript:void(0);" id = "a_id_${s.index}" onclick="js_method(${listTemp.id },this.id,2)">录入</a>
		   		</td>
	   		</tr>
	   </c:forEach>
	
	</table>
	
	修改记录：<br/>
	<table align="center" border="1px;" style="border-collapse: collapse;width: 800px;" bordercolor="#000000">
	   <tr>
	   		<td>序号</td>
	   		<td>修改前</td>
	   		<td>修改后</td>
	   		<td>时间</td>
	   		<td>操作者</td>
	   </tr>
	   
	   <c:forEach items="${projectChangeList}" var="project_change" varStatus="s" >
			<tr>
		   		<td></td>
		   		<td>${project_change.changeBefore}</td>
		   		<td>${project_change.changeAfter}</td>
		   		<td>${project_change.createTime}</td>
		   		<td>${project_change.optName}</td>
		   		
	   		</tr>
	   </c:forEach>
	
	</table>
	
</body>
</html>
