package com.ync365.oa.web.employe;

import java.text.SimpleDateFormat;
import java.util.Date;
import java.util.List;
import java.util.Map;

import javax.validation.Valid;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.beans.propertyeditors.CustomDateEditor;
import org.springframework.data.domain.Page;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.ServletRequestDataBinder;
import org.springframework.web.bind.annotation.InitBinder;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestMethod;

import com.google.common.collect.Maps;
import com.ync365.oa.entity.Department;
import com.ync365.oa.entity.Employe;
import com.ync365.oa.query.EmployeQuery;
import com.ync365.oa.service.department.DepartmentService;
import com.ync365.oa.service.employe.EmployeService;

@Controller
@RequestMapping(value="/employe")
public class EmployeController {

	@Autowired
	private EmployeService employeService;
	
	@Autowired
	private DepartmentService departmentService;
	
	/***
	 * 页面列表
	 * @param model
	 * @return
	 */
	@RequestMapping(value="/list",method =RequestMethod.GET)
	public String list(Model model){
		EmployeQuery e=new EmployeQuery();
		Page<Employe> employes =employeService.find(e);
		model.addAttribute("employes",employes);
		return "employe/employeList";
	}
	/***
	 * 导入员工的页面
	 * @return
	 */
	@RequestMapping(value="/addPage",method = RequestMethod.GET)
	public String addPage(){
			return "employe/addPage";
		}
	/***
	 * 导入员工
	 * @return
	 */
	@RequestMapping(value="/add",method = RequestMethod.POST)
	public String add(Employe e){
		System.out.println("1234");
		//employeService.add(employe);
		return "";
	}
	/***
	 * 编辑页面
	 * @param id
	 * @param model
	 * @return
	 */
	@RequestMapping(value="/editPage/{id}",method = RequestMethod.GET)
	public String editPage(@PathVariable int id,Model model){
		Employe e=employeService.findOne(id);
		model.addAttribute("employe",e);
		
		List<Department> d=departmentService.getAll();
		model.addAttribute("dept",d);
		
		return "employe/editPage";
	}
	/****
	 * 查看页面
	 * @param id
	 * @param model
	 * @return
	 */
	@RequestMapping(value="/view/{id}",method = RequestMethod.GET)
	public String selectById(@PathVariable int id,Model model){
		Employe e=employeService.findOne(id);
		model.addAttribute("employe",e);

		return "employe/employeForm";
	}
	/***
	 * 密码重置
	 * @param id
	 * @param model
	 * @return
	 */
	@RequestMapping(value="/passwdReset/{id}",method = RequestMethod.GET)
	public String passwdReset(@PathVariable int id,Model model){
		//employeService.passwdReset(id, password);

		return "employe/employeForm";
	}
	
	@InitBinder
    public void InitBinder(ServletRequestDataBinder bin) {
        bin.registerCustomEditor(Date.class, new CustomDateEditor( new SimpleDateFormat("yyyy-MM-dd"), true));
    }
	
}