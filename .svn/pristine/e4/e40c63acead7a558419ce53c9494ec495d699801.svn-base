package com.ync365.oa.web.specialty;


import java.util.List;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestMethod;

import com.ync365.commons.utils.CurrentUser;
import com.ync365.oa.entity.SpecialtyJX;
import com.ync365.oa.service.account.ShiroDbRealm.ShiroUser;
import com.ync365.oa.service.employe.EmployeService;
import com.ync365.oa.service.specialty.SpecialtyJXService;

/**
 * 专业性绩效----前台控制层
 * @author lyh
 *
 */
@Controller
@RequestMapping(value = "/specialtyJX")
public class SpecialtyJXController {
	@Autowired
	private SpecialtyJXService specialtyJXService;	
	@Autowired
	private EmployeService employeService;	
	
	/**
	 * 某个员工的专业性绩效
	 * @param beEvaluatedId
	 * @param createTime
	 * @param model
	 * @return
	 */
	@RequestMapping(value = "/employeJX")
	public String employeJX(String createTime,Model model) {
		//获取登录人的id
		ShiroUser currentUser = CurrentUser.getCurrentUser();
		List<SpecialtyJX> employeJX = specialtyJXService.getSpecialtyJXByEmployeId(currentUser.id, createTime);
		model.addAttribute("employeJX", employeJX);
		return "specialtyJX/employeJX";
	}
	
	/**
	 * 按月份获取某个MT负责人下的所有员工的专业性评价列表(本月评价上个月的)
	 * @param beEvaluatedId
	 * @param createTime
	 * @param model
	 * @return
	 */
	@RequestMapping(value = "/employeJXList")
	public String list(String createTime,Model model) {
		//获取登录人的id
		ShiroUser currentUser = CurrentUser.getCurrentUser();
		List<SpecialtyJX> employeJXList = specialtyJXService.getAllSpecialtyJXByEvaluatedId(currentUser.id, createTime);
		model.addAttribute("employeJXList", employeJXList);
		return "specialtyJX/employeJXList";
	}
	
	/**
	 * 去评价或修改专业性页面
	 * @param beEvaluatedId
	 * @param createTime
	 * @param model
	 * @return
	 */
	@RequestMapping(value = "/evaluatePage",method = RequestMethod.POST)
    public String evaluate(Long beEvaluatedId,String createTime,Model model) {
		List<SpecialtyJX> employeJX = specialtyJXService.getSpecialtyJXByEmployeId(beEvaluatedId, createTime);
		model.addAttribute("employeJX", employeJX);	
        return "specialtyJX/evaluate";
    }
	
	/**
	 * 专业性--绩效评价或修改绩效评价(每月1号至3号可以修改或评价上个月的专业性)
	 */
	@RequestMapping(value = "/evaluate",method = RequestMethod.POST)
    public String evaluate(List<SpecialtyJX> specialtyJXlist,int operation) {		
		specialtyJXService.evaluate(specialtyJXlist,operation);		
        return "specialtyJX/employeJXList";
    }
}
