<%@ page contentType="text/html;charset=UTF-8" %>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<%@ taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt" %>
<c:set var="ctx" value="${pageContext.request.contextPath}"/>
<html>
<head>
<script src="${ctx }/static/My97/WdatePicker.js"></script>
<script type="text/javascript" src="${ctx}/static/jquery/jquery-1.9.1.min.js"></script>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>员工月度效能</title>
<style type="text/css">
.d1 {
	margin-left: 100px;
}
#foot{
	margin-left: 140px;
}
#split{
	margin-left: 100px;
}
#dataAll{
	margin-left: 140px;
}
#head{
	margin-left: 120px;
}
</style>
<script type="text/javascript">
	function f(){
		var  myselect=document.getElementById("selectDept");
		var index=myselect.selectedIndex ; 
		var  id=myselect.options[index].value;
		var text=myselect.options[index].text;
		 
		document.getElementById("departmentName").value=text;
		
	}
</script>
<script type="text/javascript">

function formatDate(times) {
	var date = new Date(times);
	var fm = date.format('yyyy-MM');
	return fm;
}

$(function(){
	var size=${pih.size()};
	$.ajaxSetup({
		   async: false
		   });
	var dataHtml="";
	for(var i=0;i<size;i++){
		var pid=document.getElementById("pih"+i+"").value;
		var state="";
		$.ajax({ 
	        type: "GET", 
	       	url: "${ctx}/admin/efficiencyResult/selectBypId/"+pid, 
	        dataType:"text", 
	        success: function(data){ 
	        	state=data;
	        } ,
		});		
 
		var html="";
		$.ajax({ 
	        type: "GET", 
	       	url: "${ctx}/admin/efficiencyResult/selectEfficiencyBypId/"+pid, 
	        dataType:"json", 
	        success: function(data){
	        		html="<span>项目名称："+data[0].projectName+"</span></br><span>项目状态："+state+"</span></br><span>项目经理："+data[0].pm+"</span></br>";
	        		html+="<table border='1'><tr>";
	        	 for(var j=0;j<data.length;j++){
	        		html+="<td>周期："+formatDate(data[j].actualBeginTime)+"~"+formatDate(data[j].actualEndTime)+"</br>计划工时："+data[j].planHours+"</br>实际工时:"+data[j].actualHours+"</br>产出工时："+data[j].outputHours+"</td>";
	        	 }
	        	 html+="</tr></table></br>";
	        } ,
		});		
		dataHtml+=html;
	}
	document.getElementById("dataAll").innerHTML=dataHtml;
});
</script>
</head>
<body>
	<form action="" method="get" id="form1">
		<div id="search">
		<table align="center" border="0px;" style="border-collapse: collapse;width: 800px;" bordercolor="#000000">
				<tr>
					<td>部门：${er.departmentName}</td><%-- <td>工号：${er.employeCode}</td> --%>
				</tr>
				<tr>
					<td>姓名：${er.employeName}</td><td>时间：<fmt:formatDate value="${er.createTime }" pattern="yyyy-MM"/></td>
				</tr>
			</table>
		</br>
		<div id="head">项目详情</div>
	</div>
	</br>
	<div id="dataAll">
	
	</div>
	<div id="data" style="display: none">
	<c:forEach items="${pih }" var="pih" varStatus="status">
			<input type="hidden" value="${pih }" id="pih${status.index}">
	</c:forEach>
	</div> 
	<div id="foot">
		计划工时：<span id="planHours">${er.planHours}</span>小时
		实际工时：<span id="actualHours">${er.actualHours}</span>小时
		产出工时：<span id="outputHours">${er.outputHours}</span>小时</br>
		负荷率： <span>${er.loadRate}%</span>效能：<span>${er.efficiencyPercentage}%</span> 效能总分：<span>${er.efficiencyTotalScore}</span>
	</div>
	</form>
</body>
</html>